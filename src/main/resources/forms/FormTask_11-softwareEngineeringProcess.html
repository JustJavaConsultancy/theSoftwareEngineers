<form id="formContainer" th:action="@{http://localhost:9010/tasks/complete}" th:object="${formData}" method="post"
      hx-post="http://localhost:9010/tasks/complete" hx-target="#formContainer" hx-swap="outerHTML"
      class="form-section">

  <input type="hidden" th:value="${id}" id="id" name="id">
  <input type="hidden" value="FormTask_11" id="nextPage" name="nextPage">

  <!-- Header Section -->
  <div class="form-header">
    <h1>Document Requirements Review</h1>
    <p>Review and edit the requirement document below</p>
  </div>

  <!-- Form Content -->
  <div class="form-content">
    <!-- Requirement Document Section -->
    <div class="mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-semibold text-gray-800">Requirement Document</h2>
        <button type="button" id="toggleViewBtn" class="toggle-btn flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
          </svg>
          Edit Mode
        </button>
      </div>

      <!-- Display View (Read-only) -->
      <div id="requirementDisplay" class="document-content max-h-96 overflow-y-auto">
        <div th:utext="${aiRequirementAnalysis}"></div>
      </div>

      <!-- Edit View (Textarea for editing) -->
      <div id="requirementEdit" class="hidden">
                <textarea id="requirement" name="requirement"
                          class="form-textarea w-full h-96"
                          th:text="${aiRequirementAnalysis}" required></textarea>
        <p class="text-sm text-gray-600 mt-2">Edit the requirement document as needed. HTML tags are supported.</p>
      </div>
    </div>

    <!-- Submit Button -->
    <div class="text-center mt-8">
      <button type="submit" id="completeButton" class="btn-complete">
        <span class="default-text">Complete Review</span>
        <span class="processing-text">
                    <span class="loading-spinner"></span>
                    Processing...
                </span>
      </button>
    </div>
  </div>

  <!-- Toggle between view and edit mode JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('toggleViewBtn');
        const displayView = document.getElementById('requirementDisplay');
        const editView = document.getElementById('requirementEdit');

        if (toggleBtn && displayView && editView) {
            toggleBtn.addEventListener('click', function() {
                if (displayView.classList.contains('hidden')) {
                    // Switching to view mode
                    displayView.classList.remove('hidden');
                    editView.classList.add('hidden');
                    toggleBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                        </svg>
                        Edit Mode
                    `;
                } else {
                    // Switching to edit mode
                    displayView.classList.add('hidden');
                    editView.classList.remove('hidden');
                    toggleBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                        View Mode
                    `;
                }
            });
        }

        // Handle form submission with button state
        const form = document.getElementById('formContainer');
        const completeButton = document.getElementById('completeButton');

        if (form && completeButton) {
            form.addEventListener('submit', function(e) {
                if (completeButton && !completeButton.disabled) {
                    completeButton.disabled = true;
                    completeButton.classList.add('processing');
                }
            });
        }
    });
  </script>
</form>